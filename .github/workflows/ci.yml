name: WinnerLens CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  backend-build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./backend

    steps:
    - uses: actions/checkout@v4
    
    - name: Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        cache-dependency-path: backend/package-lock.json

    - name: Install dependencies
      run: npm install

    - name: Generate Prisma Client
      run: npx prisma generate

    - name: Build
      run: npm run build
      env:
        # ë¹Œë“œ ê³¼ì •ì—ì„œ íƒ€ìž… ì²´í¬ ë“±ì„ ìœ„í•´ ë”ë¯¸ í™˜ê²½ë³€ìˆ˜ê°€ í•„ìš”í•  ìˆ˜ ìžˆìŒ
        DATABASE_URL: "postgresql://user:password@localhost:5432/winnerlens"
        JWT_SECRET: "ci-test-secret"

    - name: ðŸŽ‰ Backend Build Success
      if: success()
      run: |
        echo "âœ… Backend build completed successfully!"
        echo "ðŸ“¦ Build artifacts ready for deployment"

  frontend-build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./frontend

    steps:
    - uses: actions/checkout@v4
    
    - name: Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Install dependencies
      run: npm install

    - name: Build
      run: npm run build
      env:
        NEXT_PUBLIC_API_URL: "http://localhost:3000/api/v1"
        # ë¹Œë“œ ì¤‘ ESLint ì—ëŸ¬ ë¬´ì‹œ ì„¤ì •ì€ next.config.jsì— ì´ë¯¸ ë˜ì–´ ìžˆìŒ

    - name: ðŸŽ‰ Frontend Build Success
      if: success()
      run: |
        echo "âœ… Frontend build completed successfully!"
        echo "ðŸŒ Live Demo: https://winnerlens.vercel.app"
        echo "ðŸ“Š GitHub Actions: https://github.com/minjae-488/WinnerLens/actions"
        echo "ðŸ› Issues: https://github.com/minjae-488/WinnerLens/issues"

  build-summary:
    runs-on: ubuntu-latest
    needs: [backend-build, frontend-build]
    if: always()
    
    steps:
    - name: ðŸ“‹ Build Summary
      run: |
        echo "## ðŸ—ï¸ WinnerLens Build Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“Š Build Status" >> $GITHUB_STEP_SUMMARY
        echo "- Backend: ${{ needs.backend-build.result }}" >> $GITHUB_STEP_SUMMARY
        echo "- Frontend: ${{ needs.frontend-build.result }}" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ”— Quick Links" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸŒ [Live Demo](https://winnerlens.vercel.app)" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ“– [Documentation](https://github.com/minjae-488/WinnerLens/blob/main/README.md)" >> $GITHUB_STEP_SUMMARY
        echo "- ðŸ› [Report Issues](https://github.com/minjae-488/WinnerLens/issues)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "Built with â¤ï¸ by WinnerLens Team" >> $GITHUB_STEP_SUMMARY

